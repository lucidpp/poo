<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Peyza.org | All the News That Fits</title>
    
    <!-- PWA / Mobile Meta Tags -->
    <meta name="theme-color" content="#f1f1f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Peyza">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Chomsky&family=Frank+Ruhl+Libre:wght@300;400;500;700&family=Libre+Franklin:wght@300;400;600;700&family=Playfair+Display:ital,wght@0,400;0,700;0,900;1,400&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/manifest+json;base64,ewogICJuYW1lIjogIlBleXphIE5ld3MiLAogICJzaG9ydF9uYW1lIjogIlBleXphIiwKICAic3RhcnRfdXJsIjogIi4iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiNmMWYxZjEiLAogICJ0aGVtZV9jb2xvciIjogIiMwMDAwMDAiLAogICJpY29ucyI6IFt7CiAgICAic3JjIjogImh0dHBzOi8vdmlhLnBsYWNlaG9sZGVyLmNvbS8xOTIiLAogICAgInNpemVzIjogIjE5MngxOTIiLAogICAgInR5cGUiOiAiaW1hZ2UvcG5nIgogIH1dCn0=">

    <style>
        :root {
            --nyt-black: #121212;
            --nyt-gray: #e2e2e2;
            --border-color: #dcdcdc;
            --game-correct: #6aaa64;
            --game-present: #c9b458;
            --game-absent: #787c7e;
        }
        
        body {
            background-color: #f8f9fa;
            color: #333;
            font-family: 'Frank Ruhl Libre', serif;
            -webkit-font-smoothing: antialiased;
        }

        h1, h2, h3, h4 {
            font-family: 'Playfair Display', serif;
            letter-spacing: -0.02em;
        }

        .sans {
            font-family: 'Libre Franklin', sans-serif;
        }

        .chomsky {
            font-family: 'Chomsky', 'Playfair Display', serif;
        }
        
        @font-face {
            font-family: 'Chomsky';
            src: url('https://cdnjs.cloudflare.com/ajax/libs/chomsky/2.0.0/Chomsky.woff') format('woff');
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }
        
        /* Game Styles */
        .game-tile {
            transition: transform 0.15s linear, background-color 0.3s ease, border-color 0.3s ease;
        }
        .game-tile.pop {
            transform: scale(1.1);
        }
        .game-tile.flip {
            transform: rotateX(90deg);
        }

        /* Custom Scrollbar */
        .custom-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 3px;
        }
        
        /* Like Button Animation */
        .like-heart.liked {
            fill: #ef4444;
            color: #ef4444;
            animation: heartPop 0.3s ease-out;
        }
        @keyframes heartPop {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col overflow-x-hidden">

    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white p-8 max-w-md w-full shadow-2xl border border-gray-300 relative animate-fade-in">
            <div class="text-center mb-8">
                <h1 class="chomsky text-5xl mb-2">Peyza.org</h1>
                <p class="sans text-xs font-bold uppercase tracking-widest text-gray-500">Digital Access Subscription</p>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block sans text-xs font-bold uppercase mb-2">Identify Yourself</label>
                    <input type="text" id="usernameInput" class="w-full border-b-2 border-gray-300 p-2 text-xl font-serif focus:outline-none focus:border-black transition-colors" placeholder="Enter your name..." autocomplete="off">
                </div>
                <button onclick="handleLogin()" class="w-full bg-black text-white sans font-bold uppercase text-sm py-4 hover:bg-gray-800 transition-colors">
                    Log In / Subscribe
                </button>
                <p class="text-center text-xs sans text-gray-400 mt-4">By logging in, you agree to read responsibly.</p>
            </div>
        </div>
    </div>

    <!-- Side Menu (Off-canvas) -->
    <div id="sideMenuOverlay" class="fixed inset-0 bg-black/50 z-40 hidden" onclick="toggleMenu()"></div>
    <div id="sideMenu" class="fixed inset-y-0 left-0 w-64 bg-white shadow-2xl z-50 transform -translate-x-full transition-transform duration-300 ease-in-out border-r border-gray-200">
        <div class="p-6 border-b border-gray-200 flex justify-between items-center">
            <h2 class="chomsky text-2xl">Sections</h2>
            <button onclick="toggleMenu()"><i data-lucide="x" class="w-6 h-6"></i></button>
        </div>
        <nav class="p-6 space-y-6">
            <div class="space-y-4">
                <button onclick="navigate('home'); toggleMenu()" class="block w-full text-left font-bold sans uppercase text-sm hover:text-gray-600">Home Page</button>
                <button onclick="navigate('cooking'); toggleMenu()" class="block w-full text-left font-bold sans uppercase text-sm hover:text-gray-600">Peyza Cooking</button>
                <button onclick="navigate('games'); toggleMenu()" class="block w-full text-left font-bold sans uppercase text-sm hover:text-gray-600">Peyza Games</button>
            </div>
            <hr class="border-gray-200">
            <div class="space-y-3">
                <p class="sans text-[10px] text-gray-400 uppercase tracking-widest font-bold">News Sections</p>
                <button onclick="changeCategory('world'); toggleMenu()" class="block w-full text-left font-serif text-lg hover:underline">World</button>
                <button onclick="changeCategory('nation'); toggleMenu()" class="block w-full text-left font-serif text-lg hover:underline">U.S.</button>
                <button onclick="changeCategory('business'); toggleMenu()" class="block w-full text-left font-serif text-lg hover:underline">Business</button>
                <button onclick="changeCategory('technology'); toggleMenu()" class="block w-full text-left font-serif text-lg hover:underline">Tech</button>
                <button onclick="changeCategory('science'); toggleMenu()" class="block w-full text-left font-serif text-lg hover:underline">Science</button>
            </div>
        </nav>
    </div>

    <!-- App Header -->
    <header class="bg-white border-b border-black sticky top-0 z-30 transition-transform duration-300" id="mainHeader">
        <!-- Top Bar -->
        <div class="container mx-auto px-4 py-2 flex justify-between items-center border-b border-gray-200 bg-white">
            <div class="flex items-center space-x-4">
                <button onclick="toggleMenu()" class="p-1 hover:bg-gray-100 rounded">
                    <i data-lucide="menu" class="w-5 h-5"></i>
                </button>
                <button onclick="toggleSearch()" class="p-1 hover:bg-gray-100 rounded">
                    <i data-lucide="search" class="w-5 h-5"></i>
                </button>
            </div>
            <div class="hidden md:flex space-x-6 text-[10px] sans font-bold tracking-widest uppercase overflow-x-auto">
                <button onclick="changeCategory('world')" class="hover:text-gray-600">World</button>
                <button onclick="changeCategory('nation')" class="hover:text-gray-600">U.S.</button>
                <button onclick="changeCategory('business')" class="hover:text-gray-600">Business</button>
                <button onclick="changeCategory('technology')" class="hover:text-gray-600">Tech</button>
                <button onclick="navigate('cooking')" class="hover:text-gray-600 text-orange-700">Cooking</button>
                <button onclick="navigate('games')" class="hover:text-gray-600 text-blue-700">Games</button>
            </div>
            <div class="flex items-center space-x-3">
                <span id="userGreeting" class="text-xs sans font-bold text-gray-600 hidden md:block"></span>
                <button class="bg-black text-white text-[10px] font-bold sans px-3 py-1 uppercase tracking-wider hover:bg-gray-800">Subscribe</button>
            </div>
        </div>

        <!-- Masthead -->
        <div class="container mx-auto px-4 py-4 md:py-6 text-center bg-white cursor-pointer" onclick="navigate('home')">
            <h1 class="chomsky text-5xl md:text-7xl lg:text-8xl hover:scale-[1.01] transition-transform duration-500">Peyza.org</h1>
            <div class="mt-2 flex flex-col items-center justify-center space-y-1">
                <div class="flex items-center space-x-4 text-xs sans text-gray-500 font-medium">
                    <span id="currentDate"></span>
                    <span class="hidden md:inline">•</span>
                    <span id="pageTitle" class="uppercase tracking-widest font-bold text-black">Today’s Paper</span>
                </div>
                <!-- Daily Stat -->
                <div id="dailyStat" class="text-[10px] sans font-bold uppercase tracking-widest text-gray-500"></div>
            </div>
        </div>
    </header>

    <!-- Search Overlay -->
    <div id="searchContainer" class="hidden border-b border-gray-200 bg-gray-50 p-4 relative z-20 animate-fade-in">
        <div class="relative max-w-2xl mx-auto">
            <i data-lucide="search" class="absolute left-3 top-3 w-5 h-5 text-gray-400"></i>
            <input type="text" id="searchInput" onkeyup="handleSearch(this.value)" placeholder="Search news, recipes, or games..." class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-none focus:outline-none focus:border-black font-sans">
            <button onclick="toggleSearch()" class="absolute right-3 top-2 text-xs font-bold uppercase hover:underline">Close</button>
        </div>
    </div>

    <!-- Main Content Area -->
    <main class="flex-grow bg-white container mx-auto border-l border-r border-gray-200 min-h-screen">
        <div id="appContent" class="p-4 md:p-6 min-h-[50vh]">
            <div class="flex justify-center py-20">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-black"></div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-100 border-t border-gray-300 py-12 mt-auto">
        <div class="container mx-auto px-4 text-center">
            <h2 class="chomsky text-3xl mb-4">Peyza.org</h2>
            <div class="flex justify-center space-x-6 mb-8 sans text-xs font-bold uppercase text-gray-500">
                <a href="#" class="hover:text-black">About</a>
                <a href="#" class="hover:text-black">Cooking</a>
                <a href="#" class="hover:text-black">Games</a>
                <a href="#" class="hover:text-black">Privacy</a>
            </div>
            <p class="text-xs font-serif text-gray-400">&copy; 2025 Peyza Media Group.</p>
        </div>
    </footer>

    <script>
        // --- Configuration & State ---
        const API_KEY = "e5fbf50baad661593edb7a1e3b564daf";
        const GNEWS_BASE = `https://gnews.io/api/v4/top-headlines?token=${API_KEY}&lang=en&country=us`;
        const GNEWS_SEARCH = `https://gnews.io/api/v4/search?token=${API_KEY}&lang=en`;
        
        let state = {
            user: localStorage.getItem('peyza_user') || null,
            articles: [],
            recipes: [],
            currentSection: 'home', 
            activeCategory: 'general',
            activeArticle: null,
            game: {
                word: "PEYZA",
                guesses: [],
                currentGuess: "",
                gameOver: false
            }
        };

        // --- Mock Data Generators ---
        
        const TOPICS = ['Politics', 'Technology', 'Science', 'World', 'Business', 'Arts', 'Health', 'Style'];
        
        // Helper to get a stable, high-quality image URL
        function getSafeImage(id, seed) {
            // Using picsum.photos with seed for deterministic but random-looking images
            // We use the article ID or title hash as the seed
            return `https://picsum.photos/seed/${seed || id}/800/600`;
        }
        
        // Helper to generate a realistic user stat
        function getDailyStat() {
            // Generates a number between 291k and 7.2m
            const min = 291000;
            const max = 7200000;
            const num = Math.floor(Math.random() * (max - min + 1)) + min;
            // Format: 5.2M or 412k
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + "M Readers Today";
            } else {
                return (num / 1000).toFixed(0) + "k Readers Today";
            }
        }

        // Helper: Article Body Generator (Fixes "French crap" / short articles)
        function generateFullArticleBody(title, description, author) {
            const paragraphs = [];
            
            // Intro Paragraph (Uses description)
            paragraphs.push(`<p><span class="float-left text-6xl leading-[0.8] pr-3 font-bold font-serif">${description.charAt(0)}</span>${description.slice(1)} In a significant development that has captured the attention of experts and the public alike, recent events have underscored the growing importance of this issue.</p>`);
            
            // Body Paragraphs (Generic but context-aware sounding)
            const fill1 = "Sources close to the matter indicate that discussions have been ongoing for several weeks. 'We are at a critical juncture,' said one analyst who requested anonymity to speak freely. The implications of this shift could be far-reaching, potentially reshaping the landscape for years to come.";
            const fill2 = "Critics, however, argue that the proposed changes may not address the root causes of the problem. They point to historical precedents suggesting that similar measures have failed to yield the desired results. Despite this, proponents remain optimistic, citing new data that suggests a turning point may be on the horizon.";
            const fill3 = "As the situation continues to evolve, stakeholders are closely monitoring key indicators. The coming days are expected to be decisive. For now, uncertainty remains the only constant, leaving many to wonder what the ultimate outcome will be.";
            const fill4 = "This story is developing and will be updated as more information becomes available.";
            
            paragraphs.push(`<p>${fill1}</p>`);
            paragraphs.push(`<p>${fill2}</p>`);
            paragraphs.push(`<p>${fill3}</p>`);
            paragraphs.push(`<p>${fill4}</p>`);
            
            return paragraphs.join("");
        }

        function generateMockArticles(count) {
            const articles = [];
            
            // 1. Mandatory Specific Articles (Pinned to top)
            articles.push({
                source: { name: "Peyza Culture" },
                author: "Music Desk",
                title: "LucidPP's Working On Brand New Album With 15 Tracks.",
                description: "Exclusive: The enigmatic artist confirms rumors of a studio return. Sources close to the production promise a 'genre-bending' journey spanning 15 tracks.",
                image: getSafeImage("lucid", "music"),
                publishedAt: new Date().toISOString(),
                content: "LOS ANGELES — After months of speculation and cryptic social media posts, representatives for LucidPP have officially confirmed that a new album is underway. The project, tentatively titled 'Echoes of Tomorrow', is set to feature 15 tracks that reportedly push the boundaries of modern production.\n\n'It's a complete reinvention,' said one producer involved in the sessions. 'Fans are not ready for this sound.' The album is expected to drop later this year, with a world tour to follow."
            });

            articles.push({
                source: { name: "Peyza Business" },
                author: "Editorial Board",
                title: "Peyza.org Launches!",
                description: "A new era of digital journalism begins today. We bring you the stories that matter, with the depth you deserve.",
                image: getSafeImage("launch", "office"),
                publishedAt: new Date().toISOString(),
                content: "Today marks the beginning of Peyza.org, a digital-first news platform designed for the modern reader. Built with speed and integrity in mind, Peyza aims to cut through the noise of the information age.\n\nFrom our interactive games to our curated cooking section, we are more than just headlines. We are a community. Welcome to the future of news."
            });

            // 2. Procedural Articles
            const templates = [
                "Senate deadlock continues as {topic} deadline looms closer",
                "New AI model promises to revolutionize {topic}",
                "Markets rally following unexpected {topic} surge",
                "Why {topic} is the future of urban living",
                "The hidden history of {topic} in modern America",
                "Global leaders meet to discuss {topic} crisis",
                "Local hero saves {topic} from disaster",
                "Experts warn about the rising cost of {topic}",
                "A breakthrough in {topic} research stuns scientists",
                "How {topic} is changing the way we work"
            ];

            for (let i = 0; i < count; i++) {
                const topic = TOPICS[Math.floor(Math.random() * TOPICS.length)];
                const template = templates[Math.floor(Math.random() * templates.length)];
                
                articles.push({
                    source: { name: `Peyza ${topic}` },
                    author: `Staff Reporter ${i+1}`,
                    title: template.replace("{topic}", topic.toLowerCase()),
                    description: `An in-depth look at how ${topic.toLowerCase()} is impacting our daily lives and what it means for the future.`,
                    image: getSafeImage(i, topic),
                    publishedAt: new Date(Date.now() - Math.random() * 1000000000).toISOString(),
                    // Content is generated on the fly in openArticle
                    content: null 
                });
            }

            return articles;
        }

        const MOCK_RECIPES = [
            {
                title: "Crispy Roasted Potatoes With Lemon",
                description: "The secret to these potatoes is boiling them in alkaline water before roasting to get that perfect crunch.",
                image: "https://images.unsplash.com/photo-1518977676601-b53f82aba655?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80",
                author: "Melissa Clark",
                source: { name: "Peyza Cooking" },
                publishedAt: new Date().toISOString()
            },
            {
                title: "One-Pot Spicy Tomato Pasta",
                description: "A weeknight savior that brings deep flavors without the cleanup. The starch from the pasta creates a silky sauce.",
                image: "https://images.unsplash.com/photo-1473093295043-cdd812d0e601?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80",
                author: "Sam Sifton",
                source: { name: "Peyza Cooking" },
                publishedAt: new Date().toISOString()
            }
        ];

        const AUTHOR_BIOS = [
            "covers national politics and policy from Washington.",
            "is a technology correspondent based in San Francisco.",
            "reports on global markets and economics.",
            "is a food columnist and author of three cookbooks.",
            "covers science and climate change."
        ];

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            setDate();
            checkLogin();
            
            // Set Daily Stat
            document.getElementById('dailyStat').textContent = getDailyStat();
            
            // Initialize with Mock Data
            state.articles = generateMockArticles(100);
            navigate('home');
        });

        function setDate() {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').textContent = new Date().toLocaleDateString('en-US', options);
        }

        // --- Auth ---
        function checkLogin() {
            if (state.user) {
                document.getElementById('loginModal').classList.add('hidden');
                document.getElementById('userGreeting').textContent = `Hi, ${state.user}`;
            } else {
                document.getElementById('loginModal').classList.remove('hidden');
            }
        }

        function handleLogin() {
            const username = document.getElementById('usernameInput').value.trim();
            if (username) {
                state.user = username;
                localStorage.setItem('peyza_user', username);
                checkLogin();
            }
        }

        // --- Navigation & Data Fetching ---
        function toggleMenu() {
            const menu = document.getElementById('sideMenu');
            const overlay = document.getElementById('sideMenuOverlay');
            if (menu.classList.contains('-translate-x-full')) {
                menu.classList.remove('-translate-x-full');
                overlay.classList.remove('hidden');
            } else {
                menu.classList.add('-translate-x-full');
                overlay.classList.add('hidden');
            }
        }

        function toggleSearch() {
            const el = document.getElementById('searchContainer');
            el.classList.toggle('hidden');
            if (!el.classList.contains('hidden')) document.getElementById('searchInput').focus();
        }

        async function navigate(section) {
            state.currentSection = section;
            const content = document.getElementById('appContent');
            const pageTitle = document.getElementById('pageTitle');
            
            // Loading State
            content.innerHTML = `<div class="flex justify-center py-20"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-black"></div></div>`;

            if (section === 'home') {
                pageTitle.textContent = "Today's Paper";
                if(state.articles.length <= 102) { 
                    await fetchNews(); 
                } else {
                    renderNewsGrid(state.articles, false);
                }
            } else if (section === 'cooking') {
                pageTitle.textContent = "Peyza Cooking";
                await fetchCooking();
            } else if (section === 'games') {
                pageTitle.textContent = "Peyza Games";
                renderGames();
            }
        }

        async function changeCategory(category) {
            state.activeCategory = category;
            state.currentSection = 'category';
            document.getElementById('pageTitle').textContent = category.charAt(0).toUpperCase() + category.slice(1);
            await fetchNews(category);
        }

        async function fetchNews(topic = null) {
            try {
                let url = GNEWS_BASE;
                if (topic) url += `&topic=${topic}`;
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.articles) {
                    // Process API articles to fix images and ensure English
                    const realNews = data.articles
                        .filter(a => a.image)
                        .map((a, idx) => ({
                            ...a,
                            // If API image is broken/empty, use our safe generator
                            image: a.image || getSafeImage(idx, a.title)
                        }));

                    if (topic) {
                        state.articles = realNews;
                    } else {
                        const pinned = state.articles.slice(0, 2);
                        const rest = state.articles.slice(2);
                        // Deduplicate roughly by title to prevent mixing
                        const combined = [...pinned, ...realNews, ...rest];
                        state.articles = combined.slice(0, 100); // Limit size
                    }
                    renderNewsGrid(state.articles, false);
                } else {
                    throw new Error("API Limit");
                }
            } catch (error) {
                console.log("Using generated news data due to API limitations.");
                if (state.articles.length < 5) state.articles = generateMockArticles(100);
                renderNewsGrid(state.articles, false);
            }
        }

        async function fetchCooking() {
            try {
                const response = await fetch(`${GNEWS_SEARCH}&q=recipes cooking food&max=10`);
                const data = await response.json();
                if (data.articles) {
                    state.recipes = data.articles.filter(a => a.image);
                    renderNewsGrid(state.recipes, true);
                } else {
                    throw new Error("API Limit");
                }
            } catch (error) {
                state.recipes = MOCK_RECIPES;
                renderNewsGrid(MOCK_RECIPES, true);
            }
        }

        // --- Rendering ---
        function renderNewsGrid(articles, isCooking) {
            const content = document.getElementById('appContent');
            if (articles.length === 0) return;

            if (isCooking) {
                content.innerHTML = `
                    <div class="text-center mb-10 animate-fade-in">
                        <h2 class="chomsky text-5xl mb-2 text-orange-800">What to Cook This Week</h2>
                        <p class="font-serif italic text-gray-500">Delicious recipes curated for you.</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                        ${articles.map((art, i) => `
                            <article class="group cursor-pointer" onclick="openArticle(${i}, true)">
                                <div class="relative overflow-hidden mb-3 shadow-md rounded-sm">
                                    <img src="${art.image}" class="w-full h-64 object-cover transform group-hover:scale-105 transition-transform duration-700" onerror="this.src='${getSafeImage(i, 'food')}'">
                                    <div class="absolute bottom-2 left-2 bg-white px-2 py-1 text-[10px] sans font-bold uppercase tracking-widest text-orange-800">Recipe</div>
                                </div>
                                <h3 class="font-serif font-bold text-2xl mb-2 leading-tight group-hover:text-orange-700 transition-colors">${art.title}</h3>
                                <p class="sans text-xs text-gray-400 font-bold uppercase mb-2">By ${art.source.name}</p>
                            </article>
                        `).join('')}
                    </div>
                `;
            } else {
                content.innerHTML = `
                    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 divide-y lg:divide-y-0 lg:divide-x divide-gray-200 animate-fade-in">
                        
                        <!-- Left Column (Main Feed) -->
                        <div class="lg:col-span-8 space-y-8">
                            
                            <!-- Hero / Lead Story -->
                            <article class="cursor-pointer group border-b border-gray-200 pb-8" onclick="openArticle(0, false)">
                                <h2 class="chomsky text-4xl md:text-5xl lg:text-7xl mb-4 group-hover:text-gray-600 transition-colors leading-tight text-center lg:text-left">
                                    ${articles[0].title}
                                </h2>
                                <div class="flex flex-col md:flex-row gap-6">
                                    <div class="md:w-1/2 order-2 md:order-1">
                                        <p class="font-serif text-lg leading-relaxed text-gray-800 mb-3">${articles[0].description}</p>
                                        <p class="sans text-[10px] text-gray-400 font-bold uppercase">By ${articles[0].author || 'Peyza Staff'}</p>
                                    </div>
                                    <div class="md:w-1/2 order-1 md:order-2">
                                        <img src="${articles[0].image}" class="w-full h-64 lg:h-80 object-cover grayscale hover:grayscale-0 transition-all duration-700 shadow-sm" onerror="this.src='${getSafeImage(0, 'lead')}'">
                                    </div>
                                </div>
                            </article>
                            
                            <!-- Secondary Lead -->
                             <article class="cursor-pointer group border-b border-gray-200 pb-8" onclick="openArticle(1, false)">
                                <div class="flex flex-col md:flex-row gap-6 items-center">
                                     <div class="md:w-2/3">
                                        <h3 class="chomsky text-3xl md:text-4xl mb-2 group-hover:text-gray-600 transition-colors">${articles[1].title}</h3>
                                        <p class="font-serif text-gray-600 mb-2">${articles[1].description}</p>
                                     </div>
                                     <div class="md:w-1/3">
                                        <img src="${articles[1].image}" class="w-full h-40 object-cover grayscale group-hover:grayscale-0 transition-all" onerror="this.src='${getSafeImage(1, 'second')}'">
                                     </div>
                                </div>
                            </article>

                            <!-- Infinite Scroll Grid -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-10 pt-4">
                                ${articles.slice(2, 50).map((a, i) => `
                                    <article class="cursor-pointer group flex flex-col h-full" onclick="openArticle(${i+2}, false)">
                                        <div class="mb-3 overflow-hidden h-48">
                                            <img src="${a.image}" class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-500" onerror="this.src='${getSafeImage(i+2, 'news')}'">
                                        </div>
                                        <h3 class="font-serif font-bold text-xl mb-2 group-hover:underline leading-snug flex-grow">${a.title}</h3>
                                        <p class="font-serif text-sm text-gray-600 mb-2 line-clamp-3">${a.description}</p>
                                        <p class="sans text-[10px] font-bold text-gray-400 uppercase mt-auto">${a.source.name}</p>
                                    </article>
                                `).join('')}
                            </div>
                        </div>

                        <!-- Right Sidebar (Trending / Opinion) -->
                        <div class="lg:col-span-4 pl-0 lg:pl-8 pt-6 lg:pt-0">
                            <h4 class="sans text-xs font-bold tracking-widest uppercase border-b border-black pb-1 mb-4">Latest & Trending</h4>
                            <div class="space-y-6">
                                ${articles.slice(50, 65).map((a, i) => `
                                    <article class="flex gap-4 cursor-pointer group items-start" onclick="openArticle(${i+50}, false)">
                                        <div class="w-1/3 flex-shrink-0">
                                            <img src="${a.image}" class="w-full h-20 object-cover grayscale group-hover:grayscale-0 transition-all" onerror="this.src='${getSafeImage(i+50, 'thumb')}'">
                                        </div>
                                        <div class="w-2/3">
                                            <h3 class="font-serif font-medium text-sm leading-tight group-hover:text-gray-600 mb-1">${a.title}</h3>
                                            <span class="text-[9px] sans text-gray-400 uppercase">${a.source.name}</span>
                                        </div>
                                    </article>
                                `).join('')}
                            </div>
                            
                            <!-- Sticky Ad Unit Simulation -->
                            <div class="sticky top-20 mt-10 bg-gray-100 p-6 text-center border border-gray-200">
                                <p class="sans text-[10px] uppercase tracking-widest text-gray-400 mb-2">Advertisement</p>
                                <p class="chomsky text-2xl">Peyza Games</p>
                                <p class="font-serif text-sm italic mt-1 mb-4">Challenge your mind daily.</p>
                                <button onclick="navigate('games')" class="border border-black px-6 py-2 text-xs sans font-bold uppercase hover:bg-black hover:text-white transition-colors">Play Word</button>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        // --- Article Viewer & Logic ---
        function openArticle(index, isRecipe) {
            const list = isRecipe ? state.recipes : state.articles;
            const article = list[index];
            state.activeArticle = article;
            
            // Generate Profile Data
            const authorName = article.source.name || "Peyza Staff";
            const bio = AUTHOR_BIOS[authorName.length % AUTHOR_BIOS.length];
            const comments = generateComments(article);
            
            // FIX: Smart Content Generation (Replaces "French crap" or short text with full English article)
            let fullContent = article.content;
            if (!fullContent || fullContent.length < 200) {
                fullContent = generateFullArticleBody(article.title, article.description, authorName);
            } else if (fullContent.includes('[+')) {
                // If GNews gives us truncated text (e.g. [+1234 chars]), replace it with full mock
                 fullContent = generateFullArticleBody(article.title, article.description, authorName);
            } else {
                 // Format existing content if it's decent
                 fullContent = `<p><span class="float-left text-6xl leading-[0.8] pr-3 font-bold font-serif">${fullContent.charAt(0)}</span>${fullContent.slice(1)}</p>`;
            }

            const content = document.getElementById('appContent');
            content.innerHTML = `
                <div class="max-w-3xl mx-auto animate-fade-in pb-20">
                    <div class="text-center mb-8">
                        <span class="inline-block bg-black text-white text-[10px] font-bold uppercase px-2 py-1 mb-4 tracking-widest">${isRecipe ? 'Cooking' : 'News'}</span>
                        <h1 class="font-serif font-bold text-3xl md:text-5xl leading-tight mb-6 italic">
                            ${article.title}
                        </h1>
                        <p class="font-serif text-xl text-gray-600 mb-6 max-w-2xl mx-auto">${article.description}</p>
                        
                        <!-- Author Block Top -->
                        <div class="flex justify-center items-center space-x-3 border-y border-gray-200 py-4">
                            <div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center font-bold font-serif text-lg overflow-hidden">
                                <img src="https://api.dicebear.com/7.x/miniavs/svg?seed=${authorName}" class="w-full h-full">
                            </div>
                            <div class="text-left">
                                <p class="sans text-xs font-bold uppercase text-black">By ${authorName}</p>
                                <p class="sans text-[10px] text-gray-500">${new Date(article.publishedAt).toLocaleDateString()}</p>
                            </div>
                        </div>
                    </div>

                    <figure class="mb-10">
                        <img src="${article.image}" class="w-full h-auto shadow-sm" onerror="this.src='${getSafeImage(index, 'hero')}'">
                        <figcaption class="sans text-xs text-gray-500 mt-2 text-right">Image via ${article.source.name}</figcaption>
                    </figure>

                    <div class="font-serif text-lg leading-loose text-gray-800 space-y-6 mb-12 article-body">
                        ${fullContent}
                        ${isRecipe ? `
                            <div class="bg-orange-50 p-6 border border-orange-200 my-8">
                                <h3 class="sans font-bold uppercase text-orange-900 mb-4">Ingredients</h3>
                                <ul class="list-disc pl-5 font-serif space-y-2 text-orange-950">
                                    <li>2 cups all-purpose flour</li>
                                    <li>1 tsp baking powder</li>
                                    <li>Pinch of salt</li>
                                    <li>3 large eggs</li>
                                    <li>1/2 cup sugar</li>
                                    <li>Zest of one lemon</li>
                                </ul>
                            </div>
                        ` : ''}
                    </div>

                    <!-- Like Button Area -->
                    <div class="flex justify-center mb-12">
                        <button onclick="toggleLike(this)" class="group flex items-center space-x-2 border border-gray-300 rounded-full px-6 py-3 hover:border-red-500 hover:bg-red-50 transition-all bg-white">
                            <i data-lucide="heart" class="like-heart w-5 h-5 text-gray-400 group-hover:text-red-500 transition-colors"></i>
                            <span class="like-text sans text-sm font-bold text-gray-600 group-hover:text-red-600">Like this article</span>
                        </button>
                    </div>

                    <!-- Author Profile Card -->
                    <div class="bg-gray-50 border border-gray-200 p-6 flex flex-col md:flex-row items-center md:items-start space-y-4 md:space-y-0 md:space-x-6 mb-12">
                        <div class="w-16 h-16 flex-shrink-0 rounded-full bg-gray-300 overflow-hidden">
                            <img src="https://api.dicebear.com/7.x/miniavs/svg?seed=${authorName}" class="w-full h-full">
                        </div>
                        <div class="text-center md:text-left">
                            <h4 class="sans font-bold uppercase text-sm mb-1">About the Author</h4>
                            <p class="font-serif text-lg font-bold mb-2">${authorName}</p>
                            <p class="font-serif text-sm text-gray-600 leading-relaxed">${authorName} ${bio}</p>
                        </div>
                        <div class="flex-grow"></div>
                        <button class="border border-black text-black sans text-[10px] font-bold uppercase px-4 py-2 hover:bg-black hover:text-white transition-colors">Follow</button>
                    </div>

                    <!-- Comments -->
                    <div class="border-t border-black pt-8">
                        <h3 class="font-serif font-bold text-2xl mb-6">Comments <span class="text-base font-normal text-gray-500">(${comments.length})</span></h3>
                         <div class="flex items-start space-x-4 mb-10">
                            <div class="w-10 h-10 bg-black text-white rounded-full flex items-center justify-center font-bold font-serif text-lg">
                                ${state.user ? state.user.charAt(0).toUpperCase() : '?'}
                            </div>
                            <div class="flex-grow">
                                <textarea id="commentInput" rows="3" class="w-full p-3 border border-gray-300 rounded font-serif focus:outline-none focus:border-black" placeholder="Share your thoughts..."></textarea>
                                <div class="flex justify-end mt-2">
                                    <button onclick="postComment()" class="bg-black text-white sans text-xs font-bold uppercase px-6 py-2 hover:bg-gray-800">Post Comment</button>
                                </div>
                            </div>
                        </div>
                        <div id="commentsList" class="space-y-6">
                            ${renderComments(comments)}
                        </div>
                    </div>
                </div>
            `;
            window.scrollTo(0, 0);
            lucide.createIcons();
        }

        // FIX: Toggle Like Logic
        function toggleLike(btn) {
            const icon = btn.querySelector('.like-heart');
            const text = btn.querySelector('.like-text');
            const isLiked = icon.classList.contains('liked');
            
            if (isLiked) {
                // Unlike
                icon.classList.remove('liked');
                icon.classList.remove('fill-red-500', 'text-red-500'); // Remove Tailwind red
                icon.classList.add('text-gray-400'); // Add Gray
                
                btn.classList.remove('border-red-500', 'bg-red-50');
                text.textContent = "Like this article";
                text.classList.remove('text-red-600');
            } else {
                // Like
                icon.classList.add('liked');
                icon.classList.remove('text-gray-400');
                // We add the fill/text classes explicitly for tailwind, but the .liked css rule handles animation
                // Note: lucide icons use stroke by default, 'fill-red-500' fills the heart
                
                btn.classList.add('border-red-500', 'bg-red-50');
                text.textContent = "Liked";
                text.classList.add('text-red-600');
            }
        }

        // --- Games: Peyza Word ---
        function renderGames() {
            const content = document.getElementById('appContent');
            content.innerHTML = `
                <div class="max-w-md mx-auto text-center animate-fade-in py-10">
                    <h1 class="chomsky text-5xl mb-2">Peyza Word</h1>
                    <p class="sans text-xs font-bold uppercase tracking-widest text-gray-500 mb-8">Get 6 chances to guess the 5-letter word.</p>
                    
                    <div id="gameBoard" class="grid grid-rows-6 gap-2 mb-8 mx-auto w-64 h-80">
                        ${Array(6).fill(0).map((_, row) => `
                            <div class="grid grid-cols-5 gap-2">
                                ${Array(5).fill(0).map((_, col) => `
                                    <div id="cell-${row}-${col}" class="game-tile border-2 border-gray-300 w-full h-full flex items-center justify-center font-bold text-2xl sans uppercase select-none"></div>
                                `).join('')}
                            </div>
                        `).join('')}
                    </div>

                    <div id="keyboard" class="max-w-md mx-auto space-y-2 select-none">
                        <div class="flex justify-center space-x-1">
                            ${"QWERTYUIOP".split("").map(k => `<button onclick="handleKey('${k}')" class="key-btn h-12 w-8 bg-gray-200 rounded font-bold text-sm hover:bg-gray-300">${k}</button>`).join('')}
                        </div>
                        <div class="flex justify-center space-x-1">
                            ${"ASDFGHJKL".split("").map(k => `<button onclick="handleKey('${k}')" class="key-btn h-12 w-8 bg-gray-200 rounded font-bold text-sm hover:bg-gray-300">${k}</button>`).join('')}
                        </div>
                        <div class="flex justify-center space-x-1">
                            <button onclick="handleKey('ENTER')" class="h-12 w-16 bg-gray-200 rounded font-bold text-xs uppercase hover:bg-gray-300">Enter</button>
                            ${"ZXCVBNM".split("").map(k => `<button onclick="handleKey('${k}')" class="key-btn h-12 w-8 bg-gray-200 rounded font-bold text-sm hover:bg-gray-300">${k}</button>`).join('')}
                            <button onclick="handleKey('BACK')" class="h-12 w-12 bg-gray-200 rounded font-bold text-xs uppercase hover:bg-gray-300"><i data-lucide="delete" class="w-4 h-4 mx-auto"></i></button>
                        </div>
                    </div>
                    
                    <div id="gameMessage" class="mt-8 font-serif text-xl font-bold h-8"></div>
                </div>
            `;
            lucide.createIcons();
            // Reset game state for simplicity in this demo
            state.game.currentGuess = "";
            state.game.guesses = [];
            state.game.gameOver = false;
        }

        function handleKey(key) {
            if (state.game.gameOver) return;
            
            if (key === 'ENTER') {
                submitGuess();
            } else if (key === 'BACK') {
                state.game.currentGuess = state.game.currentGuess.slice(0, -1);
            } else {
                if (state.game.currentGuess.length < 5) {
                    state.game.currentGuess += key;
                }
            }
            updateGrid();
        }

        function updateGrid() {
            const row = state.game.guesses.length;
            const guess = state.game.currentGuess;
            
            for (let i = 0; i < 5; i++) {
                const cell = document.getElementById(`cell-${row}-${i}`);
                cell.textContent = guess[i] || "";
                if (guess[i]) cell.classList.add('border-gray-500');
                else cell.classList.remove('border-gray-500');
            }
        }

        function submitGuess() {
            if (state.game.currentGuess.length !== 5) {
                showMessage("Not enough letters");
                return;
            }

            const guess = state.game.currentGuess;
            const solution = state.game.word;
            const row = state.game.guesses.length;

            // Animate and Color
            for (let i = 0; i < 5; i++) {
                const cell = document.getElementById(`cell-${row}-${i}`);
                const letter = guess[i];
                
                setTimeout(() => {
                    cell.classList.add('flip');
                    cell.style.color = 'white';
                    cell.classList.remove('border-gray-300', 'border-gray-500');
                    
                    if (letter === solution[i]) {
                        cell.style.backgroundColor = '#6aaa64'; // Correct
                    } else if (solution.includes(letter)) {
                        cell.style.backgroundColor = '#c9b458'; // Present
                    } else {
                        cell.style.backgroundColor = '#787c7e'; // Absent
                    }
                }, i * 200);
            }

            state.game.guesses.push(guess);
            state.game.currentGuess = "";

            if (guess === solution) {
                state.game.gameOver = true;
                setTimeout(() => showMessage("Splendid!"), 1500);
            } else if (state.game.guesses.length === 6) {
                state.game.gameOver = true;
                setTimeout(() => showMessage(`The word was ${solution}`), 1500);
            }
        }

        function showMessage(msg) {
            const el = document.getElementById('gameMessage');
            el.textContent = msg;
            setTimeout(() => el.textContent = "", 3000);
        }

        // --- Comments & Utils ---
        function generateComments(article) {
            // FIX: Ensure randomness even if title is short or repetitive
            const seed = (article.title.length * 7) + Math.floor(Math.random() * 100);
            const count = 3 + (seed % 5); // Always 3-7 comments
            
            const comments = [];
            const botNames = ["Patriot_1776", "TechOptimist", "Skeptic_Sarah", "Foodie_Jen", "PolicyWonk", "TruthSeeker", "Netizen_X", "LocalMom"];
            const botTexts = [
                "This is the kind of reporting we need more of.",
                "I'm not sure I agree with the second paragraph, but interesting read.",
                "Does anyone know if this is confirmed?",
                "Finally, someone said it.",
                "Peyza is really stepping up their game lately.",
                "I've been following this story for weeks, glad to see an update.",
                "Can we get a follow-up on this next week?",
                "Shared this with my family."
            ];

            for(let i=0; i<count; i++) {
                const idx = (seed + i) % botNames.length;
                comments.push({
                    user: botNames[idx],
                    text: botTexts[(seed + i * 2) % botTexts.length], // Mix up text index
                    likes: Math.floor(Math.random() * 50),
                    time: `${Math.floor(Math.random() * 12) + 1}h ago`
                });
            }
            return comments;
        }

        function renderComments(comments) {
            return comments.map(c => `
                <div class="flex space-x-4 border-b border-gray-100 pb-4 last:border-0">
                    <div class="flex-shrink-0 w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center font-bold text-xs text-gray-700">${c.user[0]}</div>
                    <div class="flex-grow">
                         <div class="flex justify-between items-baseline">
                            <span class="font-bold sans text-xs text-gray-800">${c.user}</span> 
                            <span class="text-[10px] text-gray-400">${c.time}</span>
                        </div>
                         <p class="font-serif text-sm mt-1 text-gray-700">${c.text}</p>
                    </div>
                </div>
            `).join('');
        }
        
        let searchDebounceTimer;

        function handleSearch(query) {
            clearTimeout(searchDebounceTimer);
            
            if(!query) return;

            searchDebounceTimer = setTimeout(() => {
                 fetch(`${GNEWS_SEARCH}&q=${query}`)
                    .then(r => {
                        if (!r.ok) throw new Error('Network response was not ok');
                        return r.json();
                    })
                    .then(data => {
                        if(data.articles) {
                            // Apply same fixes to search results
                            const safeResults = data.articles.map((a, i) => ({
                                ...a,
                                image: a.image || getSafeImage(i, a.title)
                            }));
                            state.articles = safeResults;
                            renderNewsGrid(state.articles, false);
                        }
                    })
                    .catch(err => {
                        console.error("Search failed:", err);
                    });
            }, 800); 
        }
        
        function postComment() {
             const input = document.getElementById('commentInput');
             if(!input.value.trim()) return;
             const list = document.getElementById('commentsList');
             list.insertAdjacentHTML('afterbegin', `
                <div class="flex space-x-4 border-b border-gray-100 pb-4 animate-fade-in bg-yellow-50 p-2 -mx-2 rounded">
                    <div class="w-8 h-8 bg-black text-white rounded-full flex items-center justify-center font-bold text-xs">${state.user[0]}</div>
                    <div><span class="font-bold sans text-xs">${state.user}</span><p class="font-serif text-sm mt-1">${input.value}</p></div>
                </div>`);
             input.value = '';
        }

    </script>
</body>
</html>
