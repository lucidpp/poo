<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peyza Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        yt: {
                            base: 'var(--bg-base)',
                            secondary: 'var(--bg-secondary)',
                            text: 'var(--text-main)',
                            textSec: 'var(--text-sec)',
                            red: '#ff0033', /* Brighter Red for Peyza */
                            hover: 'var(--bg-hover)',
                            border: 'var(--border-color)',
                            accent: '#3ea6ff'
                        }
                    },
                    animation: {
                        'pop': 'pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)',
                        'slide-up': 'slideUp 0.3s ease-out'
                    },
                    keyframes: {
                        pop: {
                            '0%': { transform: 'scale(1)' },
                            '50%': { transform: 'scale(1.2)' },
                            '100%': { transform: 'scale(1)' }
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(10px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        :root {
            /* Dark Mode (Default) - Glassy */
            --bg-base: #0f0f0f;
            --bg-glass: rgba(15, 15, 15, 0.85);
            --bg-secondary: rgba(255, 255, 255, 0.05);
            --bg-hover: rgba(255, 255, 255, 0.1);
            --text-main: #f1f1f1;
            --text-sec: #aaaaaa;
            --border-color: rgba(255, 255, 255, 0.1);
            --studio-sidebar: rgba(20, 20, 20, 0.9);
        }

        html:not(.dark) {
            /* Light Mode - Glassy */
            --bg-base: #f9f9f9;
            --bg-glass: rgba(255, 255, 255, 0.85);
            --bg-secondary: rgba(0, 0, 0, 0.05);
            --bg-hover: rgba(0, 0, 0, 0.1);
            --text-main: #0f0f0f;
            --text-sec: #606060;
            --border-color: rgba(0, 0, 0, 0.1);
            --studio-sidebar: rgba(255, 255, 255, 0.9);
        }

        body {
            background-color: var(--bg-base);
            background-image: radial-gradient(circle at 50% 0%, rgba(255,0,50,0.05), transparent 40%);
            color: var(--text-main);
            font-family: 'Roboto', sans-serif;
            overflow-x: hidden;
            transition: background-color 0.3s, color 0.3s;
        }

        /* Glassmorphism Utility */
        .glass {
            background: var(--bg-glass);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border-color);
        }
        
        .glass-panel {
            background: var(--bg-secondary);
            backdrop-filter: blur(8px);
            border: 1px solid var(--border-color);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(136, 136, 136, 0.5); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(136, 136, 136, 0.8); }
        
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Interactive Elements */
        .btn-click {
            transition: transform 0.1s;
        }
        .btn-click:active {
            transform: scale(0.95);
        }

        /* Chart CSS */
        .chart-bar { transition: height 0.5s ease; }
        .chart-tooltip { display: none; }
        .chart-column:hover .chart-tooltip { display: block; }

        /* Custom scrollbar-hide for horizontal navigation on channel page */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="flex flex-col h-screen">

    <!-- Header -->
    <header class="h-14 fixed w-full z-50 glass flex items-center justify-between px-4 transition-colors duration-300">
        <div class="flex items-center gap-4">
            <button class="p-2 rounded-full hover:bg-yt-hover text-yt-text hidden md:block btn-click" onclick="app.toggleSidebar()">
                <i class="fa-solid fa-bars text-xl"></i>
            </button>
            <div class="flex items-center gap-1 cursor-pointer btn-click" onclick="app.navigate('home')">
                <div class="bg-yt-red text-white rounded-lg px-2 py-0.5 font-bold text-xs shadow-lg shadow-red-500/20"><i class="fa-solid fa-play text-sm"></i></div>
                <span class="font-bold text-xl tracking-tighter font-sans">Peyza</span>
            </div>
        </div>

        <div class="hidden md:flex flex-1 max-w-xl mx-4" id="search-bar">
            <div class="flex w-full group">
                <input type="text" placeholder="Search" class="w-full bg-yt-secondary border border-yt-border rounded-l-full py-2 px-4 focus:outline-none focus:border-blue-500 placeholder-yt-textSec text-yt-text transition-all">
                <button class="bg-yt-secondary border border-l-0 border-yt-border px-5 rounded-r-full hover:bg-yt-hover btn-click">
                    <i class="fa-solid fa-magnifying-glass text-yt-text"></i>
                </button>
            </div>
        </div>

        <div class="flex items-center gap-2 md:gap-4">
            <button onclick="app.toggleTheme()" class="p-2 rounded-full hover:bg-yt-hover text-yt-text btn-click" title="Toggle Theme">
                <i class="fa-solid fa-circle-half-stroke text-xl"></i>
            </button>

            <button onclick="app.showCreateModal()" class="flex items-center gap-2 bg-yt-secondary hover:bg-yt-hover px-3 py-1.5 rounded-full transition-colors border border-yt-border btn-click group">
                <i class="fa-solid fa-video text-yt-red group-hover:scale-110 transition-transform"></i>
                <span class="text-sm font-medium hidden sm:inline text-yt-text">Create</span>
            </button>
            
            <button class="p-2 rounded-full hover:bg-yt-hover relative text-yt-text btn-click">
                <i class="fa-regular fa-bell text-xl"></i>
                <span id="notif-badge" class="absolute top-1 right-1 bg-yt-red text-white text-[10px] px-1 rounded-full hidden shadow-sm">0</span>
            </button>
            
            <div onclick="app.navigate('channel')" class="w-8 h-8 rounded-full bg-gradient-to-tr from-purple-600 to-blue-500 flex items-center justify-center cursor-pointer text-sm font-bold overflow-hidden border border-yt-border btn-click">
                <img id="header-avatar" src="" class="w-full h-full object-cover">
            </div>
        </div>
    </header>

    <div class="flex flex-1 pt-14 h-full">
        <!-- Main Sidebar -->
        <aside id="main-sidebar" class="w-20 lg:w-60 hidden md:flex flex-col fixed h-full glass z-40 transition-colors duration-300 border-r border-yt-border pb-20">
            <div class="flex flex-col gap-2 p-2">
                <button onclick="app.navigate('home')" class="flex items-center gap-4 px-3 py-2 rounded-lg hover:bg-yt-hover text-left group text-yt-text btn-click">
                    <i class="fa-solid fa-house text-xl w-6 text-center"></i>
                    <span class="text-sm hidden lg:block font-medium">Home</span>
                </button>
                <button onclick="app.navigate('studio')" class="flex items-center gap-4 px-3 py-2 rounded-lg hover:bg-yt-hover text-left text-yt-text btn-click">
                    <i class="fa-solid fa-wand-magic-sparkles text-xl w-6 text-center text-purple-500"></i>
                    <span class="text-sm hidden lg:block font-medium">Studio</span>
                </button>
                <div class="border-t border-yt-border my-2 hidden lg:block mx-3"></div>
                <div class="hidden lg:block px-3 py-2 text-base font-bold text-yt-text">You</div>
                <button onclick="app.navigate('channel')" class="flex items-center gap-4 px-3 py-2 rounded-lg hover:bg-yt-hover text-left bg-yt-secondary border border-yt-border text-yt-text btn-click">
                    <i class="fa-solid fa-user-circle text-xl w-6 text-center"></i>
                    <span class="text-sm hidden lg:block font-medium">Your Channel</span>
                </button>
                <button onclick="app.nextDay()" class="flex items-center gap-4 px-3 py-2 rounded-lg hover:bg-green-500/10 text-green-500 text-left mt-4 border border-green-500/20 btn-click group">
                    <i class="fa-solid fa-calendar-day text-xl w-6 text-center group-hover:rotate-12 transition-transform"></i>
                    <span class="text-sm hidden lg:block font-medium">Next Day</span>
                </button>
                <div class="px-3 mt-1">
                    <p class="text-xs text-yt-textSec hidden lg:block pl-1">Day: <span id="day-counter" class="font-bold text-yt-text">1</span></p>
                </div>
                
                <div class="mt-auto p-2">
                    <button onclick="app.toggleSettings()" class="flex items-center gap-4 px-3 py-2 rounded-lg hover:bg-yt-hover text-left text-yt-textSec w-full btn-click">
                        <i class="fa-solid fa-gear text-xl w-6 text-center"></i>
                        <span class="text-sm hidden lg:block font-medium">Settings</span>
                    </button>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main id="main-content" class="flex-1 md:ml-20 lg:ml-60 overflow-y-auto relative transition-colors duration-300">
            <!-- Dynamic Content -->
        </main>
    </div>

    <!-- Mobile Bottom Nav -->
    <nav class="md:hidden fixed bottom-0 w-full glass z-50 flex justify-around items-center h-14 text-[10px] text-yt-text pb-2">
        <div onclick="app.navigate('home')" class="flex flex-col items-center gap-1 p-2 cursor-pointer btn-click">
            <i class="fa-solid fa-house text-xl"></i>
            <span>Home</span>
        </div>
        <div onclick="app.navigate('studio')" class="flex flex-col items-center gap-1 p-2 cursor-pointer btn-click">
            <i class="fa-solid fa-chart-simple text-xl"></i>
            <span>Studio</span>
        </div>
        <div onclick="app.showCreateModal()" class="flex flex-col items-center justify-center -mt-8">
            <div class="bg-yt-secondary w-12 h-12 rounded-full flex items-center justify-center border border-yt-border shadow-xl btn-click">
                <i class="fa-solid fa-plus text-2xl text-yt-text"></i>
            </div>
        </div>
        <div onclick="app.nextDay()" class="flex flex-col items-center gap-1 p-2 cursor-pointer text-green-500 btn-click">
            <i class="fa-solid fa-calendar-day text-xl"></i>
            <span>Next Day</span>
        </div>
        <div onclick="app.navigate('channel')" class="flex flex-col items-center gap-1 p-2 cursor-pointer btn-click">
            <img id="nav-avatar" src="" class="w-6 h-6 rounded-full border border-yt-border">
            <span>You</span>
        </div>
    </nav>

    <!-- Create Video Modal -->
    <div id="create-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[60] hidden flex items-center justify-center p-4 animate-slide-up">
        <div class="glass-panel w-full max-w-lg rounded-2xl p-6 relative shadow-2xl text-yt-text">
            <button onclick="app.closeCreateModal()" class="absolute top-4 right-4 text-yt-textSec hover:text-yt-text btn-click">
                <i class="fa-solid fa-xmark text-2xl"></i>
            </button>
            <h2 class="text-xl font-bold mb-6">Upload Video</h2>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-xs font-bold text-yt-textSec mb-1 uppercase tracking-wider">Title</label>
                    <input type="text" id="video-title" class="w-full bg-yt-base/50 border border-yt-border rounded-lg p-3 focus:border-yt-text outline-none text-yt-text transition-colors" placeholder="E.g. My First Vlog!">
                </div>
                
                <div>
                    <label class="block text-xs font-bold text-yt-textSec mb-1 uppercase tracking-wider">Thumbnail</label>
                    <div class="grid grid-cols-3 gap-2">
                        <button onclick="app.selectThumbStyle('gaming')" class="thumb-opt border border-yt-border hover:bg-yt-hover p-2 rounded-lg text-center text-sm text-yt-text btn-click transition-colors" data-style="gaming">ðŸŽ® Gaming</button>
                        <button onclick="app.selectThumbStyle('vlog')" class="thumb-opt border border-yt-border hover:bg-yt-hover p-2 rounded-lg text-center text-sm text-yt-text btn-click transition-colors" data-style="vlog">ðŸ“· Vlog</button>
                        <button onclick="app.selectThumbStyle('tech')" class="thumb-opt border border-yt-border hover:bg-yt-hover p-2 rounded-lg text-center text-sm text-yt-text btn-click transition-colors" data-style="tech">ðŸ’» Tech</button>
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-bold text-yt-textSec mb-1 uppercase tracking-wider">Description</label>
                    <textarea id="video-desc" class="w-full bg-yt-base/50 border border-yt-border rounded-lg p-3 h-24 resize-none outline-none text-yt-text" placeholder="Tell viewers about your video..."></textarea>
                </div>
                
                <div class="pt-4 flex justify-end">
                    <button onclick="app.uploadVideo()" class="bg-yt-red hover:bg-red-700 text-white font-bold py-2 px-6 rounded-full text-sm uppercase tracking-wide shadow-lg shadow-red-600/20 btn-click">
                        Upload
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[70] hidden flex items-center justify-center p-4 animate-slide-up">
        <div class="glass-panel w-full max-w-sm rounded-2xl p-6 relative shadow-2xl text-yt-text">
            <button onclick="app.toggleSettings()" class="absolute top-4 right-4 text-yt-textSec hover:text-yt-text btn-click">
                <i class="fa-solid fa-xmark text-xl"></i>
            </button>
            <h2 class="text-xl font-bold mb-4">Settings</h2>
            <div class="space-y-4">
                <div class="p-3 bg-yt-hover rounded-lg border border-yt-border">
                    <label class="block text-xs font-bold text-yt-textSec mb-2 uppercase">Subscriber Editor (Cheat)</label>
                    <div class="flex gap-2">
                         <input type="number" id="cheat-subs" class="flex-1 bg-yt-base border border-yt-border rounded p-2 text-yt-text outline-none">
                         <button onclick="app.saveSettings()" class="bg-yt-text text-yt-base font-bold px-4 rounded hover:opacity-90 btn-click">Save</button>
                    </div>
                </div>
                <div class="text-xs text-yt-textSec text-center">Version 2.1 â€¢ Peyza Simulator</div>
            </div>
        </div>
    </div>

    <!-- Description/About Modal -->
    <div id="desc-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[70] hidden flex items-center justify-center p-4 animate-slide-up">
        <div class="glass-panel w-full max-w-lg rounded-2xl p-6 relative shadow-2xl text-yt-text flex flex-col max-h-[80vh]">
            <div class="flex justify-between items-center mb-4 border-b border-yt-border pb-2">
                <h2 class="text-xl font-bold">About</h2>
                <button onclick="app.toggleDescModal()" class="text-yt-text hover:bg-yt-hover p-2 rounded-full w-10 h-10 flex items-center justify-center btn-click"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            
            <div class="overflow-y-auto pr-2 space-y-4">
                <div>
                    <h3 class="font-bold text-lg mb-2">Description</h3>
                    <p id="modal-bio-text" class="text-sm whitespace-pre-wrap text-yt-textSec"></p>
                </div>
                <div>
                    <h3 class="font-bold text-lg mb-2">Details</h3>
                    <div class="flex items-center gap-3 text-sm text-yt-textSec mb-2"><i class="fa-solid fa-earth-americas w-5"></i> United States</div>
                    <div class="flex items-center gap-3 text-sm text-yt-textSec mb-2"><i class="fa-solid fa-info-circle w-5"></i> Joined <span id="modal-join-date"></span></div>
                    <div class="flex items-center gap-3 text-sm text-yt-textSec mb-2"><i class="fa-solid fa-chart-line w-5"></i> <span id="modal-total-views"></span> views</div>
                </div>
                <div>
                    <h3 class="font-bold text-lg mb-2">Links</h3>
                    <div id="modal-links" class="space-y-3"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed bottom-20 left-1/2 -translate-x-1/2 glass px-6 py-3 rounded-full shadow-2xl transform translate-y-24 transition-transform duration-300 z-[80] text-sm font-bold flex items-center gap-2 border border-yt-border">
        <i class="fa-solid fa-circle-info text-blue-500"></i> <span id="toast-msg">Notification</span>
    </div>

    <script>
        const GameState = {
            day: 1,
            user: {
                name: "New Tuber",
                handle: "@newtuber",
                avatar: "https://ui-avatars.com/api/?name=New+Tuber&background=random",
                banner: "https://picsum.photos/1200/300?blur=2",
                subscribers: 0,
                totalViews: 0,
                joinedDate: new Date().toLocaleDateString(),
                bio: "Welcome to my channel! I make videos about everything.",
                links: [
                    { name: "Twitter", url: "https://twitter.com" },
                    { name: "Instagram", url: "https://instagram.com" }
                ]
            },
            videos: [],
            playlists: [],
            posts: [],
            otherVideos: [],
            selectedThumb: 'vlog',
            analyticsHistory: [],
            theme: 'dark'
        };

        const App = {
            view: 'home',
            subView: 'dashboard',
            
            init() {
                this.loadGame();
                this.applyTheme();
                this.generateRandomFeed();
                this.render();
                this.updateHeader();
                if (GameState.analyticsHistory.length === 0) for(let i=0; i<28; i++) GameState.analyticsHistory.push(0);
                this.selectThumbStyle(GameState.selectedThumb); // Ensure initial selection is styled
            },

            loadGame() {
                const saved = localStorage.getItem('peyzaSave_v1');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    // Use a simple Object.assign for merging top-level properties
                    // Complex deep merging logic is not strictly necessary for this state structure
                    Object.assign(GameState, parsed);
                }
            },

            saveGame() { localStorage.setItem('peyzaSave_v1', JSON.stringify(GameState)); },

            toggleTheme() { GameState.theme = GameState.theme === 'dark' ? 'light' : 'dark'; this.applyTheme(); this.saveGame(); },
            applyTheme() { 
                document.querySelector('html').className = GameState.theme;
            },

            navigate(page, data = null) {
                this.view = page; this.viewData = data;
                if (page !== 'studio') {
                    document.getElementById('main-sidebar').classList.remove('hidden');
                    document.getElementById('search-bar').classList.remove('hidden');
                }
                // When navigating to studio, ensure subView is set if not already defined (or if coming from customization link)
                if (page === 'studio' && typeof data === 'string') {
                    this.subView = data;
                } else if (page === 'studio') {
                    this.subView = 'dashboard';
                }
                this.render(); window.scrollTo(0, 0);
            },

            setStudioTab(tab) {
                this.subView = tab;
                this.render();
            },

            nextDay() {
                GameState.day++;
                let dailyViews = 0, dailySubs = 0;
                
                // Video Logic
                GameState.videos.forEach(video => {
                    const age = GameState.day - video.uploadDay;
                    let freshness = Math.max(0.05, 1 / (Math.pow(age, 1.5) + 0.5));
                    let newViews = Math.floor(Math.max(20, GameState.user.subscribers * 0.15) * freshness * (Math.random() * 2));
                    video.views += newViews; dailyViews += newViews;
                    if (newViews > 0) {
                        video.likes += Math.floor(newViews * 0.1 * (0.8 + Math.random() * 0.2));
                        if (Math.random() < 0.3) this.generateComment(video);
                    }
                });

                // Post Logic (Community Tab)
                GameState.posts.forEach(post => {
                    // Posts get activity for 3 days
                    if (GameState.day - post.dayPosted < 3) {
                         post.likes += Math.floor(Math.random() * (GameState.user.subscribers * 0.05 + 5));
                         post.comments += Math.floor(Math.random() * 2);
                    }
                });

                dailySubs = Math.floor(dailyViews / (50 + Math.random() * 50));
                GameState.user.subscribers += dailySubs;
                GameState.user.totalViews += dailyViews;
                GameState.analyticsHistory.shift(); GameState.analyticsHistory.push(dailyViews);

                this.saveGame(); this.updateHeader(); this.render();
                document.getElementById('day-counter').innerText = GameState.day;
                this.showToast(`Day ${GameState.day}: +${this.formatNumber(dailyViews)} Views`);
            },

            generateComment(video) {
                const comments = ["Great video!", "First!", "Love this.", "Subbed!", "Awesome.", "Cool.", "Nice editing.", "Wow!"];
                video.comments.unshift({ user: "User"+Math.floor(Math.random()*1000), text: comments[Math.floor(Math.random()*comments.length)], likes: Math.floor(Math.random()*10), timestamp: "Today", replies: [] });
            },

            generateRandomFeed() {
                if (GameState.otherVideos.length > 0) return;
                const titles = ["Epic Challenge", "Review", "My Life", "Tutorial", "Gaming Moment", "Vlog #101", "Unboxing"];
                GameState.otherVideos = Array.from({length: 12}, (_, i) => ({
                    id: `other_${i}`, title: titles[Math.floor(Math.random()*titles.length)] + " #" + (i+1),
                    creator: "Creator"+(i+1), views: Math.floor(Math.random()*500000), timestamp: "1 day ago",
                    thumbnail: `https://picsum.photos/seed/${i+999}/320/180`, avatar: `https://ui-avatars.com/api/?name=C`
                }));
            },

            uploadVideo() {
                const title = document.getElementById('video-title').value;
                const desc = document.getElementById('video-desc').value;
                if (!title) { this.showToast("Title required!"); return; }
                const newVideo = {
                    id: Date.now(), title: title, description: desc, views: 0, likes: 0, dislikes: 0,
                    uploadDay: GameState.day, timestamp: "Just now", thumbStyle: GameState.selectedThumb,
                    thumbnail: this.getThumbUrl(GameState.selectedThumb), comments: []
                };
                newVideo.views += Math.floor(Math.random() * 50); // Initial boost
                GameState.videos.unshift(newVideo);
                this.saveGame(); this.closeCreateModal(); this.navigate('studio', 'content'); this.showToast("Video Uploaded!");
            },

            postStatus() {
                const text = document.getElementById('status-input').value;
                if (!text) return;
                GameState.posts.unshift({
                    id: Date.now(), text: text, likes: 0, comments: 0, dayPosted: GameState.day, date: "Just now"
                });
                this.saveGame(); this.render(); this.showToast("Status Posted!");
            },

            createPlaylist() {
                const name = prompt("Enter Playlist Name:");
                if(name) {
                    GameState.playlists.push({ id: Date.now(), name: name, videos: [], updated: "Just now" });
                    this.saveGame(); this.render();
                    this.showToast(`Playlist '${name}' created!`);
                }
            },

            updateProfile() {
                GameState.user.name = document.getElementById('edit-name').value;
                GameState.user.handle = document.getElementById('edit-handle').value;
                GameState.user.bio = document.getElementById('edit-bio').value;
                // Avatar/Banner are currently hardcoded for simplicity in the UI, but we can store the mock data
                // GameState.user.avatar = document.getElementById('edit-avatar').value;
                // GameState.user.banner = document.getElementById('edit-banner').value;

                // Update Links
                const linkNames = document.querySelectorAll('.link-name');
                const linkUrls = document.querySelectorAll('.link-url');
                const newLinks = [];
                linkNames.forEach((el, index) => {
                    if(el.value && linkUrls[index].value) newLinks.push({ name: el.value, url: linkUrls[index].value });
                });
                GameState.user.links = newLinks;

                this.saveGame(); this.updateHeader(); this.showToast("Channel Updated!");
                this.render(); // Re-render studio to update lists
            },

            addLinkInput(name='', url='') {
                const container = document.getElementById('links-editor');
                if (!container) return; // Prevent error if container doesn't exist yet
                const div = document.createElement('div');
                div.className = 'flex gap-2 mb-2 animate-slide-up';
                div.innerHTML = `
                    <input type="text" value="${name}" class="link-name w-1/3 bg-yt-base border border-yt-border rounded p-2 text-sm text-yt-text outline-none" placeholder="Title">
                    <input type="text" value="${url}" class="link-url flex-1 bg-yt-base border border-yt-border rounded p-2 text-sm text-yt-text outline-none" placeholder="URL">
                    <button onclick="this.parentElement.remove(); app.saveGame()" class="text-yt-textSec hover:text-yt-red p-2 btn-click"><i class="fa-solid fa-trash"></i></button>
                `;
                container.appendChild(div);
            },

            toggleSettings() {
                const modal = document.getElementById('settings-modal');
                modal.classList.toggle('hidden');
                if(!modal.classList.contains('hidden')) document.getElementById('cheat-subs').value = GameState.user.subscribers;
            },
            
            saveSettings() {
                const subs = parseInt(document.getElementById('cheat-subs').value);
                if(!isNaN(subs) && subs >= 0) { 
                    GameState.user.subscribers = subs; 
                    this.saveGame(); 
                    this.toggleSettings(); 
                    this.showToast(`Subscribers set to ${this.formatNumber(subs)}`); 
                    this.updateHeader(); 
                    this.render(); // Re-render to update channel stats
                } else {
                    this.showToast("Invalid number for subscribers.");
                }
            },

            toggleDescModal() {
                const modal = document.getElementById('desc-modal');
                if (modal.classList.contains('hidden')) {
                    document.getElementById('modal-bio-text').innerText = GameState.user.bio;
                    document.getElementById('modal-join-date').innerText = GameState.user.joinedDate;
                    document.getElementById('modal-total-views').innerText = this.formatNumber(GameState.user.totalViews);
                    document.getElementById('modal-links').innerHTML = GameState.user.links.map(l => `<a href="${l.url}" target="_blank" class="flex items-center gap-3 text-blue-500 hover:underline cursor-pointer"><i class="fa-solid fa-link text-yt-textSec"></i> ${l.name}</a>`).join('');
                    modal.classList.remove('hidden');
                } else modal.classList.add('hidden');
            },

            animateLike(btn) {
                // Find the parent element to apply animation to icon
                const icon = btn.querySelector('.fa-thumbs-up');
                if (icon) {
                    icon.classList.add('text-blue-500', 'animate-pop');
                    setTimeout(() => icon.classList.remove('animate-pop'), 300);
                }
                // Simulate like count increase for visual feedback
                let currentLikes = parseInt(btn.innerText.trim().replace('K', '000').replace('M', '000000'));
                currentLikes = isNaN(currentLikes) ? 1 : currentLikes + 1;
                btn.innerHTML = `<i class="fa-regular fa-thumbs-up"></i> ${this.formatNumber(currentLikes)}`;
            },

            render() {
                const main = document.getElementById('main-content');
                main.innerHTML = '';
                const sidebar = document.getElementById('main-sidebar');
                if (this.view === 'studio') {
                    sidebar.classList.add('hidden'); document.getElementById('search-bar').classList.add('hidden');
                    this.renderStudio(main);
                } else {
                    this.renderHome(main); // Defaults
                    if (this.view === 'channel') this.renderChannel(main);
                    if (this.view === 'video') this.renderVideoPage(this.viewData);
                }
            },

            renderHome(container) {
                if (this.view !== 'home') return;
                let html = `
                    <div class="p-4 md:p-6 pb-20">
                        <div class="flex gap-2 mb-6 overflow-x-auto pb-2 scrollbar-hide sticky top-0 z-20 glass pt-2">
                            <span class="bg-yt-text text-yt-base px-3 py-1 rounded-lg text-sm font-bold whitespace-nowrap btn-click cursor-pointer">All</span>
                            <span class="bg-yt-secondary hover:bg-yt-hover border border-yt-border px-3 py-1 rounded-lg text-sm font-medium whitespace-nowrap transition-colors cursor-pointer text-yt-text btn-click">Gaming</span>
                            <span class="bg-yt-secondary hover:bg-yt-hover border border-yt-border px-3 py-1 rounded-lg text-sm font-medium whitespace-nowrap transition-colors cursor-pointer text-yt-text btn-click">Music</span>
                            <span class="bg-yt-secondary hover:bg-yt-hover border border-yt-border px-3 py-1 rounded-lg text-sm font-medium whitespace-nowrap transition-colors cursor-pointer text-yt-text btn-click">Live</span>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-x-4 gap-y-8">
                `;
                // Merge feed
                let displayVideos = [...GameState.otherVideos];
                GameState.videos.slice(0, 3).forEach(v => displayVideos.splice(Math.floor(Math.random()*displayVideos.length), 0, { ...v, isUser: true, creator: GameState.user.name, avatar: GameState.user.avatar }));
                
                displayVideos.forEach(v => {
                    html += `
                        <div class="flex flex-col gap-2 cursor-pointer fade-in group" onclick="${v.isUser ? `app.navigate('video', GameState.videos.find(x => x.id == ${v.id}))` : 'app.showToast(\'This is an external video and cannot be viewed in the simulator.\')'}">
                            <div class="relative aspect-video rounded-xl overflow-hidden bg-gray-800 shadow-lg group-hover:shadow-2xl transition-all duration-300 group-hover:-translate-y-1">
                                <img src="${v.thumbnail}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500">
                                <span class="absolute bottom-1 right-1 bg-black/80 text-white text-xs px-1 rounded font-bold backdrop-blur-sm">10:00</span>
                            </div>
                            <div class="flex gap-3">
                                <img src="${v.avatar}" class="w-9 h-9 rounded-full mt-1 object-cover border border-yt-border">
                                <div>
                                    <h3 class="font-bold text-sm line-clamp-2 leading-tight mb-1 text-yt-text group-hover:text-blue-400 transition-colors">${v.title}</h3>
                                    <div class="text-xs text-yt-textSec">
                                        <p class="hover:text-yt-text transition-colors">${v.creator} ${v.isUser ? '<i class="fa-solid fa-circle-check text-[10px] text-yt-textSec"></i>' : ''}</p>
                                        <p>${this.formatNumber(v.views)} views â€¢ ${v.timestamp}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                container.innerHTML = html + `</div></div>`;
            },

            renderChannel(container) {
                const u = GameState.user;
                const tabs = ['Home', 'Videos', 'Playlists', 'Community', 'About'];
                const activeTab = this.viewData || 'Home'; 
                let contentHtml = '';

                if (activeTab === 'Community') {
                    contentHtml = `
                        <div class="max-w-3xl mx-auto animate-slide-up">
                            <div class="glass-panel rounded-xl p-4 mb-6 shadow-lg">
                                <div class="flex gap-3">
                                    <img src="${u.avatar}" class="w-10 h-10 rounded-full object-cover">
                                    <div class="flex-1">
                                        <input id="status-input" type="text" placeholder="Post an update to your fans..." class="w-full bg-transparent border-b border-yt-border focus:border-yt-text outline-none py-2 text-yt-text mb-2 transition-colors">
                                        <div class="flex justify-end">
                                            <button onclick="app.postStatus()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-1.5 rounded-full text-sm font-bold shadow-lg btn-click">Post</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="space-y-4">
                                ${GameState.posts.map(p => `
                                    <div class="glass-panel border border-yt-border rounded-xl p-4">
                                        <div class="flex gap-3 mb-2">
                                            <img src="${u.avatar}" class="w-8 h-8 rounded-full object-cover">
                                            <div>
                                                <div class="text-sm font-bold text-yt-text">${u.name} <span class="text-xs font-normal text-yt-textSec">â€¢ ${p.date}</span></div>
                                            </div>
                                        </div>
                                        <p class="text-sm mb-3 text-yt-text">${p.text}</p>
                                        <div class="flex gap-4 text-yt-textSec text-sm">
                                            <button onclick="app.animateLike(this); p.likes++; app.saveGame()" class="cursor-pointer hover:text-yt-text btn-click flex items-center gap-1"><i class="fa-regular fa-thumbs-up"></i> ${this.formatNumber(p.likes)}</button>
                                            <button class="cursor-pointer hover:text-yt-text btn-click flex items-center gap-1"><i class="fa-regular fa-comment"></i> ${this.formatNumber(p.comments)}</button>
                                        </div>
                                    </div>
                                `).join('')}
                                ${GameState.posts.length === 0 ? '<p class="text-center text-yt-textSec italic">No posts yet. Engage with your community!</p>' : ''}
                            </div>
                        </div>
                    `;
                } else if (activeTab === 'Playlists') {
                    contentHtml = GameState.playlists.length > 0 ? `
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 animate-slide-up">
                             ${GameState.playlists.map(pl => `
                                <div class="cursor-pointer group">
                                    <div class="aspect-video rounded-xl overflow-hidden bg-yt-secondary mb-2 relative border-r-8 border-gray-600 group-hover:border-yt-red transition-colors shadow-lg">
                                        <div class="absolute inset-0 flex items-center justify-center text-yt-textSec group-hover:text-white">
                                            <i class="fa-solid fa-list text-3xl"></i>
                                        </div>
                                        <div class="absolute bottom-1 right-2 bg-black/80 text-white text-xs px-1 rounded font-bold">${pl.videos.length} videos</div>
                                    </div>
                                    <h3 class="font-bold text-sm text-yt-text group-hover:text-blue-400 transition-colors">${pl.name}</h3>
                                    <p class="text-xs text-yt-textSec">Updated ${pl.updated}</p>
                                </div>
                            `).join('')}
                        </div>
                    ` : `<div class="text-center py-10 text-yt-textSec flex flex-col items-center"><i class="fa-solid fa-list-ul text-4xl mb-4 opacity-50"></i>No playlists yet. Create one in Studio!</div>`;
                } else if (activeTab === 'Videos') {
                    contentHtml = `
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 animate-slide-up">
                            ${GameState.videos.map(v => `
                                <div class="cursor-pointer group" onclick="app.navigate('video', GameState.videos.find(x => x.id == ${v.id}))">
                                    <div class="aspect-video rounded-xl overflow-hidden bg-gray-800 mb-2 relative shadow-md">
                                        <img src="${v.thumbnail}" class="w-full h-full object-cover group-hover:scale-105 transition-transform">
                                    </div>
                                    <h3 class="font-bold text-sm line-clamp-2 text-yt-text group-hover:text-blue-400">${v.title}</h3>
                                    <p class="text-xs text-yt-textSec">${this.formatNumber(v.views)} views â€¢ Day ${v.uploadDay}</p>
                                </div>
                            `).join('')}
                        </div>`;
                } else if (activeTab === 'About') {
                    contentHtml = `<div class="text-center py-10"><button onclick="app.toggleDescModal()" class="text-blue-500 hover:underline btn-click">View Full Description</button></div>`;
                } else {
                    // Home
                    contentHtml = GameState.videos.length > 0 ? `
                        <div class="flex flex-col md:flex-row gap-6 mb-8 border-b border-yt-border pb-8 animate-slide-up">
                            <div class="w-full md:w-1/2 aspect-video bg-gray-800 rounded-xl overflow-hidden cursor-pointer shadow-2xl group" onclick="app.navigate('video', GameState.videos[0])">
                                <img src="${GameState.videos[0].thumbnail}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500">
                            </div>
                            <div class="flex-1 py-2">
                                <h3 class="text-2xl font-bold text-yt-text mb-2">${GameState.videos[0].title}</h3>
                                <p class="text-sm text-yt-textSec mb-4">${this.formatNumber(GameState.videos[0].views)} views â€¢ ${GameState.videos[0].timestamp}</p>
                                <p class="text-sm text-yt-textSec line-clamp-3">${GameState.videos[0].description}</p>
                            </div>
                        </div>
                        <h3 class="font-bold text-lg mb-4 text-yt-text">Recent Uploads</h3>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                             ${GameState.videos.slice(0, 4).map(v => `
                                <div class="cursor-pointer group" onclick="app.navigate('video', GameState.videos.find(x => x.id == ${v.id}))">
                                    <div class="aspect-video rounded-xl overflow-hidden bg-gray-800 mb-2 relative shadow-lg">
                                        <img src="${v.thumbnail}" class="w-full h-full object-cover group-hover:scale-105 transition-transform">
                                    </div>
                                    <h3 class="font-bold text-sm line-clamp-2 text-yt-text group-hover:text-blue-400">${v.title}</h3>
                                    <p class="text-xs text-yt-textSec">${this.formatNumber(v.views)} views</p>
                                </div>
                            `).join('')}
                        </div>
                    ` : `<div class="text-center py-20 text-yt-textSec">Upload a video to get started!</div>`;
                }

                container.innerHTML = `
                    <div class="h-32 md:h-52 w-full bg-cover bg-center" style="background-image: url('${u.banner}')"></div>
                    <div class="glass px-4 md:px-12 py-6 flex flex-col md:flex-row gap-6 items-center md:items-start border-b border-yt-border pb-4 relative shadow-lg">
                        <img src="${u.avatar}" class="w-24 h-24 md:w-32 md:h-32 rounded-full border-4 border-yt-base -mt-12 object-cover bg-yt-base shadow-xl">
                        <div class="flex-1 text-center md:text-left -mt-2">
                            <h1 class="text-3xl font-bold text-yt-text tracking-tight">${u.name}</h1>
                            <div class="flex flex-wrap justify-center md:justify-start gap-2 text-sm text-yt-textSec mb-2 items-center">
                                <span class="font-bold text-yt-text">${u.handle}</span>
                                <span>â€¢</span>
                                <span>${this.formatNumber(u.subscribers)} subscribers</span>
                                <span>â€¢</span>
                                <span>${GameState.videos.length} videos</span>
                            </div>
                            <div class="flex items-center justify-center md:justify-start gap-2 text-sm text-yt-textSec cursor-pointer hover:text-yt-text transition-colors" onclick="app.toggleDescModal()">
                                <p class="line-clamp-1 max-w-md italic">${u.bio}</p>
                                <i class="fa-solid fa-chevron-right text-xs"></i>
                            </div>
                            <div class="flex gap-2 justify-center md:justify-start mt-4">
                                <button onclick="app.navigate('studio', 'customization')" class="bg-yt-secondary hover:bg-yt-hover text-yt-text px-4 py-2 rounded-full text-sm font-bold transition-colors border border-yt-border btn-click">Customize channel</button>
                                <button onclick="app.navigate('studio', 'content')" class="bg-yt-secondary hover:bg-yt-hover text-yt-text px-4 py-2 rounded-full text-sm font-bold transition-colors border border-yt-border btn-click">Manage videos</button>
                            </div>
                        </div>
                    </div>
                    <div class="px-4 md:px-12 mt-2 border-b border-yt-border sticky top-0 glass z-30">
                        <div class="flex gap-6 overflow-x-auto scrollbar-hide">
                            ${tabs.map(t => `<button onclick="app.navigate('channel', '${t}')" class="py-3 px-2 border-b-2 text-sm font-bold uppercase tracking-wide transition-all ${activeTab === t ? 'border-yt-text text-yt-text' : 'border-transparent text-yt-textSec hover:text-yt-text hover:border-yt-textSec/50'}">${t}</button>`).join('')}
                        </div>
                    </div>
                    <div class="p-4 md:p-12 min-h-[400px]">
                        ${contentHtml}
                    </div>
                `;
            },

            renderStudio(container) {
                // Studio Sidebar
                const studioSidebar = `
                    <div class="w-64 border-r border-yt-border flex flex-col pt-6 hidden md:flex glass z-10">
                        <div class="px-6 mb-8 flex flex-col items-center text-center">
                            <img src="${GameState.user.avatar}" class="w-20 h-20 rounded-full mb-3 object-cover border-2 border-yt-border shadow-md">
                            <h3 class="font-bold text-sm text-yt-text">Your Channel</h3>
                            <p class="text-xs text-yt-textSec">${GameState.user.name}</p>
                        </div>
                        <nav class="flex-1 px-3 space-y-1">
                            ${['Dashboard', 'Content', 'Analytics', 'Customization'].map(t => `
                                <button onclick="app.setStudioTab('${t.toLowerCase()}')" class="w-full flex items-center gap-4 px-4 py-3 rounded-lg text-left text-sm font-bold transition-all btn-click ${this.subView === t.toLowerCase() ? 'bg-yt-hover text-yt-red border-l-4 border-yt-red' : 'text-yt-textSec hover:bg-yt-hover hover:text-yt-text'}">
                                    <i class="fa-solid ${t==='Dashboard'?'fa-gauge-high':t==='Content'?'fa-video':t==='Analytics'?'fa-chart-line':'fa-wand-magic'} w-5"></i> ${t}
                                </button>
                            `).join('')}
                        </nav>
                        <div class="p-4 border-t border-yt-border">
                             <button onclick="app.navigate('home')" class="text-xs text-yt-textSec hover:text-yt-text flex items-center gap-2 btn-click"><i class="fa-solid fa-arrow-left"></i> Back to Peyza</button>
                        </div>
                    </div>
                `;

                // Content Area
                let content = '';
                if (this.subView === 'customization') {
                    content = `
                        <h2 class="text-2xl font-bold mb-6 text-yt-text animate-slide-up">Channel customization</h2>
                        <div class="space-y-6 max-w-3xl animate-slide-up">
                            <div class="glass-panel rounded-xl p-6">
                                <h3 class="font-bold text-lg mb-4 text-yt-text">Basic Info</h3>
                                <div class="space-y-4">
                                    <div><label class="block text-xs font-bold text-yt-textSec mb-1">NAME</label><input type="text" id="edit-name" value="${GameState.user.name}" class="w-full bg-yt-base border border-yt-border rounded p-2 text-yt-text outline-none focus:border-blue-500"></div>
                                    <div><label class="block text-xs font-bold text-yt-textSec mb-1">HANDLE</label><input type="text" id="edit-handle" value="${GameState.user.handle}" class="w-full bg-yt-base border border-yt-border rounded p-2 text-yt-text outline-none focus:border-blue-500"></div>
                                    <div><label class="block text-xs font-bold text-yt-textSec mb-1">BIO</label><textarea id="edit-bio" class="w-full bg-yt-base border border-yt-border rounded p-2 text-yt-text outline-none focus:border-blue-500 h-24 resize-none">${GameState.user.bio}</textarea></div>
                                </div>
                            </div>
                            <div class="glass-panel rounded-xl p-6">
                                <div class="flex justify-between items-center mb-4"><h3 class="font-bold text-lg text-yt-text">Links</h3><button onclick="app.addLinkInput()" class="text-blue-500 text-xs font-bold uppercase hover:bg-blue-500/10 px-2 py-1 rounded btn-click">+ Add Link</button></div>
                                <div id="links-editor" class="space-y-2"></div>
                            </div>
                            <div class="glass-panel rounded-xl p-6">
                                <div class="flex justify-between items-center mb-4"><h3 class="font-bold text-lg text-yt-text">Playlists</h3><button onclick="app.createPlaylist()" class="text-blue-500 text-xs font-bold uppercase hover:bg-blue-500/10 px-2 py-1 rounded btn-click">+ New Playlist</button></div>
                                <div class="space-y-2 text-sm text-yt-textSec">${GameState.playlists.map(pl => `<div class="p-2 border border-yt-border rounded bg-yt-base flex justify-between"><span>${pl.name}</span><span>${pl.videos.length} vids</span></div>`).join('')}</div>
                            </div>
                            <div class="flex justify-end pt-2"><button onclick="app.updateProfile()" class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-2 rounded font-bold uppercase text-sm shadow-lg btn-click">Publish</button></div>
                        </div>
                    `;
                    // Populate links on load
                    setTimeout(() => {
                        const linkContainer = document.getElementById('links-editor');
                        if(linkContainer && linkContainer.children.length === 0) GameState.user.links.forEach(l => app.addLinkInput(l.name, l.url));
                    }, 0);
                } else if (this.subView === 'dashboard') {
                    // Re-use logic from previous version but glass style
                    content = `<h2 class="text-2xl font-bold mb-6 text-yt-text animate-slide-up">Dashboard</h2>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 animate-slide-up">
                        <div class="glass-panel rounded-xl p-6">
                             <h3 class="font-bold mb-2">Channel Analytics</h3>
                             <p class="text-4xl font-bold mb-2">${this.formatNumber(GameState.user.subscribers)} <span class="text-base font-normal text-yt-textSec">Subscribers</span></p>
                             <div class="h-2 w-full bg-yt-hover rounded-full overflow-hidden"><div class="h-full bg-blue-500" style="width: ${Math.min(100, (GameState.user.subscribers/1000)*100)}%"></div></div>
                             <p class="text-xs text-yt-textSec mt-2">Progress to 1K</p>
                        </div>
                        <div class="glass-panel rounded-xl p-6">
                            <h3 class="font-bold mb-4">Latest Video</h3>
                            ${GameState.videos[0] ? `<div class="flex gap-4 cursor-pointer" onclick="app.navigate('video', GameState.videos[0])"><img src="${GameState.videos[0].thumbnail}" class="w-32 rounded-lg"><div class="flex-1"><h4 class="font-bold line-clamp-1">${GameState.videos[0].title}</h4><p class="text-yt-textSec text-sm">${this.formatNumber(GameState.videos[0].views)} Views</p></div></div>` : '<p class="text-yt-textSec">No videos yet.</p>'}
                        </div>
                    </div>`;
                } else {
                     content = `<h2 class="text-2xl font-bold mb-6 text-yt-text animate-slide-up capitalize">${this.subView}</h2><p class="text-yt-textSec">Detailed ${this.subView} view coming soon.</p>`;
                }

                container.innerHTML = `<div class="flex min-h-[calc(100vh-56px)]">${studioSidebar}<div class="flex-1 p-8 overflow-y-auto">${content}</div></div>`;
            },

            updateHeader() { 
                document.getElementById('header-avatar').src = GameState.user.avatar; 
                document.getElementById('nav-avatar').src = GameState.user.avatar; 
                if(document.getElementById('day-counter')) document.getElementById('day-counter').innerText = GameState.day; 
            },
            showCreateModal() { document.getElementById('create-modal').classList.remove('hidden'); },
            closeCreateModal() { document.getElementById('create-modal').classList.add('hidden'); document.getElementById('video-title').value = ""; document.getElementById('video-desc').value = ""; },
            selectThumbStyle(style) {
                GameState.selectedThumb = style;
                document.querySelectorAll('.thumb-opt').forEach(el => {
                    if(el.dataset.style === style) { el.classList.add('bg-blue-600', 'border-blue-600', 'text-white'); el.classList.remove('border-yt-border', 'text-yt-text'); }
                    else { el.classList.remove('bg-blue-600', 'border-blue-600', 'text-white'); el.classList.add('border-yt-border', 'text-yt-text'); }
                });
            },
            showToast(msg) {
                const t = document.getElementById('toast'); document.getElementById('toast-msg').innerText = msg;
                t.classList.remove('translate-y-24'); setTimeout(() => t.classList.add('translate-y-24'), 3000);
            },
            getThumbUrl(style) { const seed = Date.now(); return style === 'gaming' ? `https://picsum.photos/seed/${seed}/640/360?grayscale` : `https://picsum.photos/seed/${seed}/640/360`; },
            formatNumber(num) {
                if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
                if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
                return num.toString();
            }
        };

        const app = App;
        window.onload = () => app.init();
    </script>
</body>
</html>
